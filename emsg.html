<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="shortcut icon" type="image/x-icon" href="/images/logo/ume.ink.fav.ico" />
    <link rel="stylesheet" href="main.css" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <style>
      body {
        background-color: #f0f0f0;
        padding-top: 30px;
      }
      #textWrapper {
        width: calc(100% - 20px);
        max-width: 800px;
        margin: 20px auto;
        padding: 0 10px;
        text-align: left;
      }
      #textWrapper textarea {
        width: calc(100% - 44px);
        max-width: 756px;
        height: 300px;
        padding: 20px;
        border: 2px solid #f24632;
        background-color: #fff;
        resize: none;
        font-size: 16px;
      }
      #textWrapper textarea:focus {
        outline-color: #f24632;
      }
      #textWrapper .info {
        padding: 7px 1px;
        font-size: 8px;
        color: #666;
      }
      .hidden {
        display: none;
      }
      #cpBt:after {
        padding-left: 5px;
        font-size: 10px;
        color: #f24632;
        content: attr(data-value);
      }
    </style>

    <title> Encrypt a message - UME.INK </title>
  </head>

  <body>
    <div class="leftAlign leftMargin">
      <a href="index.html">< Back</a>
    </div>
    <div id="textWrapper">
      <h5 id="notify">type a message:</h5>
      <textarea id="msgbox" autofocus></textarea>
      <button id='encBt' onclick="encrypt()">encrypt it with my PGP public key</button>
      <button id='editBt' class="hidden" onclick="edit()">back to edit mode</button>
      <a id='sendm' class="hidden buttonStyle" href="" target="_blank">mail to me</a>
      <span id='cpBt' class="hidden"><button onclick="copy()">COPY</button></span>
      <div class="info">Powered by OpenPGP.js, works well with recent versions of Chrome, Firefox, Safari and Edge</div>
    </div>
    <script src="/openpgp.min.js" integrity="sha384-TS0uWY7lSW2o43PKPc6ICKryJRZV2gtYvuV/U/h0hKkCC/DIDxOHRIo6w/tH+ql7"></script>
    <script>
      const pubkey =
        ['-----BEGIN PGP PUBLIC KEY BLOCK-----',
         '',
         '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',
         'tzC6c/ClswJ3y5yRnHU7g1nvjgkwVQ==',
         '=PAtn',
         '-----END PGP PUBLIC KEY BLOCK-----'].join('\n');
        var msg = '';
        const notif  = document.getElementById('notify');
        const encBt  = document.getElementById('encBt');
        const sendBt = document.getElementById('sendm');
        const cpBtS  = document.getElementById('cpBt');
        const editBt = document.getElementById('editBt');
        const msgB   = document.getElementById('msgbox');

        const encryptFunction = async(m) => {
          const publicKey = await openpgp.readKey({ armoredKey: pubkey });
          const encrypted = await openpgp.encrypt({
              message: await openpgp.createMessage({ text: m }),
              encryptionKeys: publicKey
          });
          return encrypted;
        }
        var encrypt = async() => {
          msg = msgB.value;
          encBt.innerHTML = 'encrypt it with my PGP public key (encrypting..)';
          cipher = (await encryptFunction(msg));
          msgB.value = cipher;
          notif.innerHTML = 'the encrypted message:';
          sendBt.href='mailto:i@bitbili.net?subject='
            + encodeURIComponent('A message from UME.INK')
            + '&body='
            + encodeURIComponent(cipher);
          msgB.disabled = true;
          msgB.style.backgroundColor = '#f3f3f3';
          encBt.style.display = 'none';
          sendBt.style.display = 'inline-block';
          editBt.style.display = 'inline-block';
          cpBtS.style.display = 'inline-block';
          window.getSelection().removeAllRanges();
          cpBtS.setAttribute('data-value', '');
        }
        function copy() {
          cpBtS.setAttribute('data-value', '');
          if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {
            var range = document.createRange();
            msgB.disabled=false;
            range.selectNodeContents(msgB);
            var s = window.getSelection();
            s.removeAllRanges();
            s.addRange(range);
            msgB.setSelectionRange(0, 999999);
            msgB.disabled=true;
          } else {
            msgB.disabled=false;
            msgB.select();
            msgB.disabled=true;
          }
          copied = window.getSelection().rangeCount > 0 && document.execCommand("copy");
          cpBtS.setAttribute('data-value', copied ? 'copied!' : 'uncopied!');
        }
        function edit() {
          msgB.value = msg;
          notif.innerHTML = 'type a message:';
          msgB.disabled = false;
          msgB.focus();
          msgB.style.backgroundColor = '#fff';
          encBt.innerHTML = 'encrypt it with my PGP public key';
          sendBt.href = '';
          encBt.style.display = 'inline-block';
          sendBt.style.display = 'none';
          editBt.style.display = 'none';
          cpBtS.style.display = 'none';
        }
    </script>
  </body>
</html>
